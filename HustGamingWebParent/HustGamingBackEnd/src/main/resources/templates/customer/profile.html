<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hồ Sơ Của Tôi</title>
    <!-- Link Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        .address-select-container {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    margin-bottom: 20px;
}

.address-select {
    flex: 1;
    appearance: none;
    background-color: #f8f9fa;
    border: 1px solid #ced4da;
    border-radius: 0.375rem;
    padding: 0.625rem;
    font-size: 1rem;
    color: #495057;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath d='M1 4l5 5 5-5z' fill='%23495057'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 8px 8px;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.address-select:focus {
    border-color: #ff5722;
    outline: 0;
    box-shadow: 0 0 0 0.2rem rgba(255, 87, 34, 0.25);
}
        .navbar-top {
            background-color: #ff5722;
            color: white;
            padding: 10px 0;
            font-size: 14px;
        }

        .navbar-top .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-top a {
            color: white;
            text-decoration: none;
            margin-right: 15px;
        }

        .navbar-top a:hover {
            text-decoration: underline;
        }

        .profile-container {
            max-width: 800px;
            margin: 30px auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 30px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #eaeaea;
            padding-bottom: 20px;
            flex-direction: column;
            text-align: center;
        }

        .profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 20px;
            border: 2px solid #ddd;
        }

        .btn-choose {
            display: inline-block;
            background-color: #ff5722;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            cursor: pointer;
            border: none;
        }

        .btn-choose:hover {
            background-color: #ff7043;
        }

        .profile-info {
            text-align: center;
        }
        textarea.form-control {
    appearance: none;
    background-color: #f8f9fa;
    border: 1px solid #ced4da;
    border-radius: 0.375rem;
    padding: 0.625rem;
    font-size: 1rem;
    color: #495057;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

textarea.form-control:focus {
    border-color: #ff5722;
    outline: 0;
    box-shadow: 0 0 0 0.2rem rgba(255, 87, 34, 0.25);
}

        .profile-form .form-group {
            margin-bottom: 20px;
        }

        .btn-update {
            background-color: #ff5722;
            border-color: #ff5722;
        }

        .btn-update:hover {
            background-color: #ff7043;
            border-color: #ff7043;
        }
    </style>
</head>
<body>
<!-- Navbar -->
<div class="navbar-top">
    <div class="container">
        <div>
            <a href="#">Kênh Người Bán</a>
            <a href="#">Tải ứng dụng</a>
            <span>Kết nối:</span>
            <a href="#"><i class="bi bi-facebook"></i></a>
            <a href="#"><i class="bi bi-instagram"></i></a>
        </div>
        <div class="navbar">
            <a href="#">Thông Báo</a>
            <a href="#">Hỗ Trợ</a>
            <a href="#">Tiếng Việt</a>

            <div class="dropdown auth-links">
                <a href="#" class="dropdown-toggle" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" th:text="${user.getFullName()}">
                    Tên Người Dùng
                </a>
                <ul class="dropdown-menu" aria-labelledby="userDropdown">
                    <li><a class="dropdown-item text-dark" th:href="@{/profile}">Tài Khoản Của Tôi</a></li>
                    <li><a class="dropdown-item text-dark" th:href="@{/orders}">Đơn Mua</a></li>
                    <li><a class="dropdown-item text-danger" th:href="@{/logout}">Đăng Xuất</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Profile Container -->
<div class="container">
    <div class="profile-container">
        <div class="profile-container">
            <div class="profile-header">
                <!-- Ảnh đại diện -->
                <img id="avatarPreview"
                     th:src="${user.image != null ? user.image : '/images/users/default-avatar.jpg'}"
                     alt="Ảnh Đại Diện"
                     class="profile-avatar"
                     style="max-width: 150px; border-radius: 50%;">

                <!-- Nút chọn ảnh -->
                <input type="file" id="avatarInput" style="display: none;" accept="image/*">
                <button type="button" class="btn-choose" onclick="document.getElementById('avatarInput').click();">
                    Chọn Ảnh
                </button>
            </div>
        </div>

        <script>
            document.getElementById('avatarInput').addEventListener('change', function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        // Cập nhật ảnh đại diện khi người dùng chọn ảnh mới
                        document.getElementById('avatarPreview').src = e.target.result;
                    };
                    reader.readAsDataURL(file);

                    // Tải ảnh lên server
                    const formData = new FormData();
                    formData.append('avatar', file);

                    // Gửi yêu cầu AJAX tới server để lưu ảnh
                    fetch('/profile/save-image', {
                        method: 'POST',
                        body: formData
                    }).then(response => {
                        if (response.ok) {
                            alert('Ảnh đại diện đã được cập nhật.');
                        } else {
                            alert('Có lỗi xảy ra khi tải ảnh lên.');
                        }
                    }).catch(error => {
                        console.error('Error:', error);
                        alert('Có lỗi xảy ra.');
                    });
                }
            });
        </script>

        <div class="profile-info">
            <h2 th:text="${user.getFullName()}">Tên Người Dùng</h2>
            <p><strong>Tên Đăng Nhập:</strong> <span th:text="${user.username}">username</span></p>
        </div>

        <form th:action=@{/profile/save-image} method="post" class="profile-form">
            <input type="hidden" th:value="${user.userID}" name="userID">

            <div class="row">
                <div class="col-md-6 form-group">
                    <label for="fullName" class="form-label">Họ và Tên</label>
                    <input type="text" class="form-control" id="fullName" name="full_name" th:value="${user.getFullName()}" required>
                </div>
                <div class="col-md-6 form-group">
                    <label for="username" class="form-label">Tên Đăng Nhập</label>
                    <input type="text" class="form-control" id="username" name="username" th:value="${user.username}" readonly>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 form-group">
                    <label for="email" class="form-label">Địa Chỉ Email</label>
                    <input type="email" class="form-control" id="email" name="email" th:value="${user.email}" readonly>
                </div>
                <div class="col-md-6 form-group">
                    <label for="phone_number" class="form-label">Số Điện Thoại</label>
                    <input type="tel" class="form-control" id="phone_number" name="phone_number" th:value="${user.phoneNumber}" required>
                </div>
            </div>
            <script src="https://esgoo.net/scripts/jquery.js"></script>
            <style type="text/css">
                .css_select_div{ text-align: center;}
                .css_select{ display: inline-table; width: 25%; padding: 5px; margin: 5px 2%; border: solid 1px #686868; border-radius: 5px;}
            </style>

            <script>
                $(document).ready(function() {
                    //Lấy tỉnh thành
                    $.getJSON('https://esgoo.net/api-tinhthanh/1/0.htm',function(data_tinh){
                        if(data_tinh.error==0){
                           $.each(data_tinh.data, function (key_tinh,val_tinh) {
                              $("#tinh").append('<option value="'+val_tinh.id+'">'+val_tinh.full_name+'</option>');
                           });
                           $("#tinh").change(function(e){
                                var idtinh=$(this).val();
                                //Lấy quận huyện
                                $.getJSON('https://esgoo.net/api-tinhthanh/2/'+idtinh+'.htm',function(data_quan){
                                    if(data_quan.error==0){
                                       $("#quan").html('<option value="0">Quận Huyện</option>');
                                       $("#phuong").html('<option value="0">Phường Xã</option>');
                                       $.each(data_quan.data, function (key_quan,val_quan) {
                                          $("#quan").append('<option value="'+val_quan.id+'">'+val_quan.full_name+'</option>');
                                       });
                                       //Lấy phường xã
                                       $("#quan").change(function(e){
                                            var idquan=$(this).val();
                                            $.getJSON('https://esgoo.net/api-tinhthanh/3/'+idquan+'.htm',function(data_phuong){
                                                if(data_phuong.error==0){
                                                   $("#phuong").html('<option value="0">Phường Xã</option>');
                                                   $.each(data_phuong.data, function (key_phuong,val_phuong) {
                                                      $("#phuong").append('<option value="'+val_phuong.id+'">'+val_phuong.full_name+'</option>');
                                                   });
                                                }
                                            });
                                       });

                                    }
                                });
                           });

                        }
                    });
                 });
            </script>
            <div class="address-select-container">
                <!-- Tỉnh Thành -->
                <select class="address-select" id="tinh" name="tinh" title="Chọn Tỉnh Thành">
                    <option value="0" th:text="${address != null && address.size() > 0 ? address[0] : 'Tỉnh Thành'}">Tỉnh Thành</option>
                </select>

                <!-- Quận Huyện -->
                <select class="address-select" id="quan" name="quan" title="Chọn Quận Huyện">
                    <option value="0" th:text="${address != null && address.size() > 1 ? address[1] : 'Quận Huyện'}">Quận Huyện</option>
                </select>

                <!-- Phường Xã -->
                <select class="address-select" id="phuong" name="phuong" title="Chọn Phường Xã">
                    <option value="0" th:text="${address != null && address.size() > 2 ? address[2] : 'Phường Xã'}">Phường Xã</option>
                </select>
            </div>

            <div class="form-group">
                <!-- Địa Chỉ Chi Tiết -->
                <label for="detailed_address" class="form-label">Địa Chỉ Chi Tiết</label>
                <textarea class="form-control" id="detailed_address" name="detailed_address" rows="3"
                          th:text="${address != null && address.size() > 3 ? address[3] : ''}"
                          placeholder="Nhập địa chỉ cụ thể (ví dụ: số nhà, tên đường)"></textarea>
            </div>



            <div class="form-group">
                <button  type="submit" class="btn btn-update btn-primary w-100">Cập Nhật Thông Tin</button>
            </div>
        </form>
    </div>
</div>


<!-- Link Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
